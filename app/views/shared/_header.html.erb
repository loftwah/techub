<header class="fixed inset-x-0 top-0 z-50 border-b border-slate-200 bg-white/70 backdrop-blur dark:border-slate-800 dark:bg-slate-950/70">
  <div class="mx-auto flex max-w-6xl items-center justify-between px-4 py-3">
    <%= link_to root_path, class: "flex items-center gap-2 text-lg font-semibold text-slate-900 dark:text-slate-100" do %>
      <span class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-slate-900 text-sm font-bold text-white shadow-sm shadow-slate-900/30 dark:bg-slate-100 dark:text-slate-900">TH</span>
      <span>TecHub</span>
    <% end %>

    <nav class="hidden lg:flex items-center gap-4 lg:gap-6 text-sm font-medium text-slate-600 dark:text-slate-300">
      <%= link_to directory_path, class: "#{nav_link_class(directory_path).sub('transition-colors', 'transition-all') + ' hover:scale-105'}", aria: { current: (current_page?(directory_path) ? 'page' : nil) } do %>
        <i class="fa-solid fa-folder-open text-[16px] leading-none align-middle"></i>
        <span class="leading-none">Directory</span>
      <% end %>
      <%= link_to leaderboards_path, class: "#{nav_link_class(leaderboards_path).sub('transition-colors', 'transition-all') + ' hover:scale-105'}", aria: { current: (current_page?(leaderboards_path) ? 'page' : nil) } do %>
        <i class="fa-solid fa-trophy text-[16px] leading-none align-middle"></i>
        <span class="leading-none">Leaderboards</span>
      <% end %>
      <%= link_to analytics_path, class: "#{nav_link_class(analytics_path).sub('transition-colors', 'transition-all') + ' hover:scale-105'}", aria: { current: (current_page?(analytics_path) ? 'page' : nil) } do %>
        <i class="fa-solid fa-chart-line text-[16px] leading-none align-middle"></i>
        <span class="leading-none">Analytics</span>
      <% end %>
      <%= link_to battles_path, class: "#{nav_link_class(battles_path).sub('transition-colors', 'transition-all') + ' hover:scale-105'}", aria: { current: (current_page?(battles_path) ? 'page' : nil) } do %>
        <i class="fa-solid fa-swords text-[16px] leading-none align-middle"></i>
        <span class="leading-none">Battles</span>
      <% end %>
      <%= link_to faq_path, class: "#{nav_link_class(faq_path).sub('transition-colors', 'transition-all') + ' hover:scale-105'}", aria: { current: (current_page?(faq_path) ? 'page' : nil) } do %>
        <i class="fa-solid fa-circle-question text-[16px] leading-none align-middle"></i>
        <span class="leading-none">FAQ</span>
      <% end %>
      <%= link_to "https://github.com/loftwah/techub", target: "_blank", rel: "noopener", class: "flex items-center gap-2 transition-all duration-200 hover:text-slate-900 dark:hover:text-slate-100 hover:scale-105" do %>
        <i class="fa-brands fa-github text-[16px] leading-none align-middle"></i>
        <span class="leading-none">Open Source</span>
      <% end %>
      <%= link_to submit_path, data: { turbo: false }, class: "#{nav_link_class(submit_path).sub('transition-colors', 'transition-all') + ' hover:scale-105'}", aria: { current: (current_page?(submit_path) ? 'page' : nil) } do %>
        <i class="fa-solid fa-paper-plane text-[16px] leading-none align-middle"></i>
        <span class="leading-none">Submit</span>
      <% end %>
      <% if current_user %>
        <%= link_to my_profiles_path, class: "#{nav_link_class(my_profiles_path).sub('transition-colors', 'transition-all') + ' hover:scale-105'}", aria: { current: (current_page?(my_profiles_path) ? 'page' : nil) } do %>
          <i class="fa-solid fa-id-badge text-[16px] leading-none align-middle"></i>
          <span class="leading-none">My Profiles</span>
        <% end %>
      <% end %>
    </nav>

    <div class="flex items-center gap-2">
      <!-- Mobile hamburger -->
      <button
        type="button"
        class="inline-flex lg:hidden h-10 w-10 items-center justify-center rounded-full border border-slate-200 bg-white text-slate-700 shadow-sm transition hover:border-slate-300 hover:bg-slate-100 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-300 dark:hover:border-slate-600 dark:hover:bg-slate-800 cursor-pointer"
        aria-controls="mobile-menu"
        aria-expanded="false"
        id="mobile-menu-button"
        aria-label="Open main menu"
      >
        <i class="fa-solid fa-bars text-xl"></i>
      </button>

      <!-- Music player toggle (mobile only) -->
      <button
        type="button"
        class="inline-flex lg:hidden h-10 w-10 items-center justify-center rounded-full bg-gradient-to-r from-indigo-600 to-sky-600 text-white shadow-sm transition hover:scale-105 cursor-pointer"
        onclick="toggleMusicPlayer()"
        aria-label="Toggle music player"
      >
        <i class="fa-solid fa-music text-lg"></i>
      </button>

      <button
        class="inline-flex h-10 w-10 items-center justify-center rounded-full border border-slate-200 bg-white text-slate-700 shadow-sm transition hover:border-slate-300 hover:bg-slate-100 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-300 dark:hover:border-slate-600 dark:hover:bg-slate-800 cursor-pointer"
        data-action="theme#toggle"
        data-theme-target="button"
      >
        <span data-theme-target="icon" aria-hidden="true">ðŸŒ—</span>
        <span class="sr-only">Toggle theme</span>
      </button>

      <% if current_user %>
        <%= button_to "Sign Out", session_path, method: :delete, class: "hidden lg:inline-flex h-10 px-3 py-2 items-center justify-center rounded-full border border-slate-200 bg-white text-slate-700 shadow-sm transition hover:border-slate-300 hover:bg-slate-100 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-300 dark:hover:border-slate-600 dark:hover:bg-slate-800 cursor-pointer" %>
      <% else %>
        <%= link_to "Login", login_path, class: "hidden lg:inline-flex h-10 px-3 py-2 items-center justify-center rounded-full border border-slate-200 bg-white text-slate-700 shadow-sm transition hover:border-slate-300 hover:bg-slate-100 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-300 dark:hover:border-slate-600 dark:hover:bg-slate-800 cursor-pointer" %>
      <% end %>
    </div>
  </div>

  <!-- Mobile menu -->
  <div id="mobile-menu" class="lg:hidden hidden border-t border-slate-200 bg-white/90 backdrop-blur dark:border-slate-800 dark:bg-slate-950/80">
    <div class="mx-auto max-w-6xl px-4 py-3">
      <div class="flex flex-col gap-2 text-slate-700 dark:text-slate-200">
        <%= link_to directory_path, class: "flex w-full items-center gap-3 px-2 py-2 rounded-lg transition-colors hover:bg-slate-100 dark:hover:bg-slate-800", aria: { current: (current_page?(directory_path) ? 'page' : nil) } do %>
          <i class="fa-solid fa-folder-open text-[18px]"></i>
          <span>Directory</span>
        <% end %>
        <%= link_to leaderboards_path, class: "flex w-full items-center gap-3 px-2 py-2 rounded-lg transition-colors hover:bg-slate-100 dark:hover:bg-slate-800", aria: { current: (current_page?(leaderboards_path) ? 'page' : nil) } do %>
          <i class="fa-solid fa-trophy text-[18px]"></i>
          <span>Leaderboards</span>
        <% end %>
        <%= link_to analytics_path, class: "flex w-full items-center gap-3 px-2 py-2 rounded-lg transition-colors hover:bg-slate-100 dark:hover:bg-slate-800", aria: { current: (current_page?(analytics_path) ? 'page' : nil) } do %>
          <i class="fa-solid fa-chart-line text-[18px]"></i>
          <span>Analytics</span>
        <% end %>
        <%= link_to battles_path, class: "flex w-full items-center gap-3 px-2 py-2 rounded-lg transition-colors hover:bg-slate-100 dark:hover:bg-slate-800", aria: { current: (current_page?(battles_path) ? 'page' : nil) } do %>
          <i class="fa-solid fa-swords text-[18px]"></i>
          <span>Battles</span>
        <% end %>
        <%= link_to faq_path, class: "flex w-full items-center gap-3 px-2 py-2 rounded-lg transition-colors hover:bg-slate-100 dark:hover:bg-slate-800", aria: { current: (current_page?(faq_path) ? 'page' : nil) } do %>
          <i class="fa-solid fa-circle-question text-[18px]"></i>
          <span>FAQ</span>
        <% end %>
        <%= link_to submit_path, data: { turbo: false }, class: "flex w-full items-center gap-3 px-2 py-2 rounded-lg transition-colors hover:bg-slate-100 dark:hover:bg-slate-800", aria: { current: (current_page?(submit_path) ? 'page' : nil) } do %>
          <i class="fa-solid fa-paper-plane text-[18px]"></i>
          <span>Submit</span>
        <% end %>

        <% if current_user %>
          <%= link_to my_profiles_path, class: "flex w-full items-center gap-3 px-2 py-2 rounded-lg transition-colors hover:bg-slate-100 dark:hover:bg-slate-800", aria: { current: (current_page?(my_profiles_path) ? 'page' : nil) } do %>
            <i class="fa-solid fa-id-badge text-[18px]"></i>
            <span>My Profiles</span>
          <% end %>
          <%= link_to current_user.login, current_user.github_profile_url, target: "_blank", rel: "noopener", class: "mt-2 inline-flex items-center justify-center rounded-lg bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-slate-700" %>
          <%= button_to "Sign Out", session_path, method: :delete, form: { class: "w-full" }, class: "mt-2 w-full inline-flex items-center justify-center rounded-lg bg-red-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-700" %>
        <% else %>
          <%= link_to "Login", login_path, class: "mt-2 inline-flex items-center justify-center rounded-lg bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-slate-700" %>
        <% end %>
      </div>
    </div>
  </div>

  <style>
    @media (min-width: 1024px) {
      /* Ensure hamburger is hidden on lg and above regardless of utility order */
      #mobile-menu-button { display: none !important; }
    }
  </style>

  <script>
    (function() {
      const btn = document.getElementById('mobile-menu-button');
      const menu = document.getElementById('mobile-menu');
      if (!btn || !menu) return;
      btn.addEventListener('click', function() {
        const isOpen = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!isOpen));
        menu.classList.toggle('hidden');
      });
    })();
  </script>
</header>
